box: wercker-labs/docker

# Build definition
build:
    steps:
        # Build the project
        - script:
            name: docker build
            code: |
                docker build -t zvelo/zvelo-docker-discover .

        # Save docker image
        - script:
            name: docker save
            code: |
                docker save zvelo/zvelo-docker-discover > ${WERCKER_OUTPUT_DIR}/zvelo-docker-discover.tar

    after-steps:
        - hipchat-notify:
            token: $HIPCHAT_TOKEN
            room-id: $HIPCHAT_ROOM_ID

deploy:
  steps:
      # Push the image to the hub
      - zvelo/docker-hub-push:
            image: zvelo/zvelo-docker-discover
            tarfile: zvelo-docker-discover.tar
            username: $DOCKER_USERNAME
            password: $DOCKER_PASSWORD
            email: $DOCKER_EMAIL

  after-steps:
    - hipchat-notify:
        token: $HIPCHAT_TOKEN
        room-id: $HIPCHAT_ROOM_ID
